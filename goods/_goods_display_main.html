{*** [위젯] 메인 상품 출력 | goods/_goods_display_main.php ***}
<!--{ ? mainData.displayFl == 'y' }-->
<!--{ ? (mainData.kind == 'event' && mainData.displayCategory == 'g' && firstGroup == 'y')}-->
<div class="item-display-wrap">
  <!--{ ? mainData.eventThemeName }-->
  <h2>{=mainData.eventThemeName}</h2>
  <!--{ / }-->

  <!--{ ? mainData.eventThemePcContents}-->
  <div class="contents">{=mainData.eventThemePcContents}</div>
  <!--{/}-->

  <!--{ ? mainData.otherEventData }-->
  <div style="text-align: right; width: 100%; margin: 10px 0 10px 0">
    <select
      name="otherEventData"
      onchange="javascript:location.href='/goods/event_sale.php?sno=' + this.value;"
    >
      <!--{ @ mainData.otherEventData }-->
      <option value="{.value_['sno']}">{.value_['themeNm']}</option>
      <!--{/}-->
    </select>
  </div>
  <!--{/}-->
</div>
<!--{/}-->
<!-- 메인에 있는 상품 부분 -->
<div
  class="goods_list main_wrap_{mainData.sno}{mainData.groupSno} display-type{themeInfo.displayType}"
>
  <!--{ ? mainData.themeNm }-->
  <div class="goods_list_tit">
    <!-- <h3>{=__(mainData.themeNm)}</h3> -->
    <!--{ ? mainData.moreTopFl == 'y' }-->
    <div class="btn_goods_more">
      <!--{ ? mainData.displayCategory == 'g'}-->
      <a
        href="/goods/goods_main.php?sno={mainData.sno}&groupSno={mainData.groupSno}"
        class="btn_goods_view_more"
        >+ {=__('더보기')}</a
      >
      <!--{ : }-->
      <a
        href="../goods/goods_main.php?sno={mainData.sno}"
        class="btn_goods_view_more"
        >+ {=__('더보기')}</a
      >
      <!--{ / }-->
    </div>
    <!--{ / }-->
  </div>
  <!--{ / }-->
  <!--{ ? mainData.pcContents }-->
  <div>{=mainData.pcContents}</div>
  <!--{ / }-->

  <!--{ ? mainData.kind == 'event' && mainData.displayCategory != 'g'}-->
  <!--{ ? mainData.otherEventData }-->
  <div style="text-align: right; width: 100%; margin: 10px 0 10px 0">
    <select
      name="otherEventData"
      onchange="javascript:location.href='/goods/event_sale.php?sno=' + this.value;"
    >
      <!--{ @ mainData.otherEventData }-->
      <option value="{.value_['sno']}">{.value_['themeNm']}</option>
      <!--{/}-->
    </select>
  </div>
  <!--{/}-->
  <!--{/}-->

  <div class="goods_list_cont goods_content_{mainData.sno}{mainData.groupSno}">
    { #goodsTemplate }
  </div>
  <!--{ ? totalPage > 1 && mainData.moreBottomFl == 'y' && themeInfo.displayType != '04' && themeInfo.displayType != '05' && themeInfo.displayType != '06' && themeInfo.displayType != '07' }-->
  <div class="btn_goods_down_more">
    <button class="btn_goods_view_down_more" data-page="2">
      {=__('더보기')}
    </button>
  </div>
  <!--{ / }-->
</div>

<style>
  /* 상품 표시 영역 스타일 */
  .main_goods_cnt {
    display: flex;
  }
  .goods_list {
    display: flex;
    flex-direction: column;
    align-items: center; /* 가운데 정렬 */
    justify-content: center; /* 가운데 정렬 */
  }

  .goods_list_cont {
    display: flex;
    /* width: 1160px; */
    width: auto;
    position: relative;
    overflow: hidden;
    margin: 0 !important; /* 가운데 정렬을 위해 마진 추가 */
    /* border: 1px solid #5882a8; */
    padding: 0 !important;
  }

  .item_cont {
    margin: 0;
    padding: 0;
  }
  .item_scroll_type {
    /* 슬라이더용 스타일 제거 */
    overflow-x: unset; /* 가로 스크롤 제거 */
    overflow: visible; /* 전체 오버플로우 허용 */
    white-space: normal; /* 줄바꿈 허용 */
    scroll-behavior: auto; /* 부드러운 스크롤 제거 */
  }
  .item_scroll_type > ul {
    display: flex;
    width: 1160px !important;
    height: 630px;
    padding-block-end: 0 !important;
    justify-content: flex-start;
    align-items: start;
  }

  .item_scroll_type > li {
    margin: 0 !important;
  }

  /* 슬라이더 상품 스타일 - 상품당 하나만 표시되도록 */

  .item_photo_box img {
    width: 713px;
    height: 630px;
    margin: 0 auto;
  }

  /* 상품 정보 스타일 */
  .item_info_cont {
    display: none !important;
    text-align: center; /* 상품 정보 중앙 정렬 */
    padding: 0 10px; /* 좌우 패딩 추가 */
  }

  /* 상품명 스타일 */
  .item_info_cont .item_tit_box .item_name {
    font-size: 16px; /* 상품명 폰트 크기 */
    font-weight: 500; /* 상품명 폰트 굵기 */
    color: #333; /* 상품명 색상 */
    margin-bottom: 10px; /* 하단 마진 */
    line-height: 1.4; /* 줄 간격 */
  }

  /* 상품 설명 스타일 */
  .item_info_cont .item_comment {
    font-size: 14px; /* 설명 폰트 크기 */
    color: #666; /* 설명 색상 */
    margin-bottom: 8px; /* 하단 마진 */
    line-height: 1.4; /* 줄 간격 */
  }

  /* 가격 스타일 */
  .item_info_cont .item_money_box {
    margin-top: 10px; /* 상단 마진 */
  }

  .item_info_cont .item_money_box .item_price {
    font-size: 18px; /* 가격 폰트 크기 */
    font-weight: bold; /* 굵게 */
    color: #000; /* 가격 색상 */
  }

  .item_info_cont .item_money_box .item_price .item_price_sale {
    color: #f44; /* 할인가 색상 */
  }

  /* 할인율 스타일 */
  .item_info_cont .item_money_box .item_price_rate {
    display: inline-block;
    padding: 3px 6px;
    font-size: 14px;
    color: white;
    background: #f44;
    border-radius: 4px;
    margin-left: 5px;
  }

  /* 상품 중앙 정렬을 위한 스타일 */
  .goods_list_cont ul {
    display: flex;
    flex-wrap: wrap;
    width: 100% !important;
    border: 1px solid #5882a8;
  }

  .goods_list_cont ul li {
    display: none; /* 모든 상품을 기본적으로 숨김 */
  }

  .goods_list_cont ul li.active {
    display: block; /* 현재 활성화된 상품만 표시 */
    margin: 0 auto; /* 가운데 정렬 */
    float: none !important; /* 기존 float 제거 */
    width: 713px !important; /* 기존 너비 제한 제거 */
  }

  /* 상품 이미지 오른쪽 설명 및 버튼 관련 */
  .goods-product-wrapper {
    position: relative;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--towbus-blue-500, #5882a8);
  }

  .goods-desc-wrapper {
    display: flex;
    flex-direction: column;
    width: 446px;
    padding: 25px 30px 42px 30px;
  }
  .goods-desc-header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 13px;
  }
  .goods-desc-logo {
    width: 100px;
    height: 27px;
  }
  /* 상품 슬라이더 컨트롤 - 오른쪽으로 배치 */
  .goods-slider-controls {
    width: auto; /* 너비 자동 조정 */
    z-index: 100;
    display: flex;
    flex-direction: row; /* 세로로 배치 */
    gap: 10px; /* 버튼 사이 간격 */
  }
  .goods-slider-button-wrapper {
    display: flex;
    flex-direction: row;
    gap: 14px;
    align-items: center;
    justify-content: center;
  }

  .goods-slider-arrow {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid #ddd;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .goods-slider-arrow:hover {
    background: #fff;
  }

  .goods-slider-arrow.prev {
    margin-left: 0;
  }

  .goods-slider-arrow.next {
    margin-right: 0;
  }

  /* 슬라이드 번호 표시 스타일 추가 */
  .slide-number {
    display: flex;
    flex-direction: row;
    gap: 8px;
    text-align: center;
    font-size: 16px;
    font-weight: 500;
    color: #9bb2d0;
  }
  .goods-slide-current {
    color: #5882a8;
    font-size: 16px;
    font-weight: 700;
  }

  .goods-desc-title {
    font-size: 22px;
    font-weight: 500;
    color: #5882a8;
  }

  /* 채팅 부분 */
  .goods-desc-chatarea {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 42px;
  }
  .goods-chatLeft {
    display: flex;
    justify-content: flex-start;
  }
  .goods-chatLeft-text {
    padding: 6px 30px;
    border-radius: 21px;
    border: 1px solid #5882a8;
    color: #5882a8;
    font-size: 16px;
    font-weight: 400;
    text-align: center;
    line-height: 23px;
    text-align: end;
  }

  .goods-chatRight {
    display: flex;
    justify-content: flex-end;
  }
  .goods-chatRight-text {
    padding: 6px 30px;
    background: #5882a8;
    border-radius: 21px;
    border: 1px solid #5882a8;
    color: #fff;
    font-size: 16px;
    font-weight: 400;
    text-align: center;
    line-height: 23px;
    text-align: end;
  }
  .goods-chatRight-bold {
    font-weight: 700;
  }

  /* 상품 보러가기 버튼 */
  .goods-go-btn {
    position: absolute;
    bottom: 0;
    width: 100%;
    border-top: 1px solid var(--towbus-blue-500, #5882a8);
    padding: 13px 25px;
    height: 75px;
    font-size: 20px;
    font-weight: 500;
    color: #5882a8;
  }
</style>

<script type="text/javascript">
  <!--
  var keyValue{mainData.sno} = '{gGlobal.locale}' + '{mainData.sno}';
  var key{mainData.sno} = {
      html: 'html' + keyValue{mainData.sno},
      page: 'page' + keyValue{mainData.sno}
  };
  var gdStorage{mainData.sno} = loadSession(key{mainData.sno}.html);
  var page{mainData.sno} = loadSession(key{mainData.sno}.page);
  $(document).ready(function() {
      if (gdStorage{mainData.sno}) {
          $('.goods_content_{mainData.sno}').html(gdStorage{mainData.sno});
          if (page{mainData.sno}) {
              $('.main_wrap_{mainData.sno} .btn_goods_view_down_more').attr('data-page',page{mainData.sno});
          }
      }
      $('.main_wrap_{mainData.sno}{mainData.groupSno} .btn_goods_view_down_more').on('click', function(e){
          gd_get_list_{mainData.sno}{mainData.groupSno}($(this).data('page'));
      });

      // 슬라이더 기능 추가
      initProductSlider();

      // 이벤트 위임: 문서 레벨에서 슬라이드 버튼 클릭 이벤트 처리
      $(document).on('click', '.goods-slider-arrow.prev', function() {
          if (window.currentIndex > 0) {
              window.currentIndex--;
              updateSlide();
          }
      });

      $(document).on('click', '.goods-slider-arrow.next', function() {
          if (window.currentIndex < window.$items.length - 1) {
              window.currentIndex++;
              updateSlide();
          }
      });
  });

  // 전역 변수 선언
  window.currentIndex = 0;
  window.$items = null;

  // 슬라이드 업데이트 함수 (전역으로 이동)
  function updateSlide() {
      window.$items.removeClass('active');
      window.$items.eq(window.currentIndex).addClass('active');

      // 기존 제품 설명 요소 제거
      $('.goods-product-wrapper').remove();

      // 현재 인덱스에 따라 다른 제품 정보 표시
      var mainPageProductWrapper;
      if (window.currentIndex === 0) {
          // 샴푸바 정보
          mainPageProductWrapper = getShampooContent();
      } else {
          // 예시 비누 정보
          mainPageProductWrapper = getSoapContent();
      }

      // 새 제품 설명 추가
      $('.goods_content_{mainData.sno}{mainData.groupSno}').append(mainPageProductWrapper);

      // 버튼 상태 업데이트
      $('.goods-slider-arrow.prev').css('opacity', window.currentIndex === 0 ? 0.5 : 1);
      $('.goods-slider-arrow.next').css('opacity', window.currentIndex === window.$items.length - 1 ? 0.5 : 1);
  }

  // 샴푸바 콘텐츠 생성 함수 (전역으로 이동)
  function getShampooContent() {
      var shampooTitle = "조약돌 샴푸바";

      // 슬라이더 컨트롤 추가
      var controlsHtml = '<div class="goods-slider-controls">' +
                        '<div class="goods-slider-button-wrapper">'+
                        '<div class="goods-slider-arrow prev">◀</div>' +
                        '<div class="slide-number">' +
                        '<span class="goods-slide-current">'+(window.currentIndex+1)+'</span>'+
                        '<span>'+"/"+'</span>'+
                        '<span>'+window.$items.length+'</span>' +
                        '</div>'+
                        '<div class="goods-slider-arrow next">▶</div>'  +
                        '</div>'+
                        '</div>';

      // 샴푸바 채팅 내용
      var chatAreaShampoo = '<div class="goods-desc-chatarea">'+
                          '<div class="goods-chatLeft">'+
                            '<span class="goods-chatLeft-text">'+
                            "요즘 두피가 너무 간지럽고 건조해"+
                            '</span>'+
                          '</div>'+
                          '<div class="goods-chatLeft">'+
                            '<span class="goods-chatLeft-text">'+
                            "자연성분의 좋은 제품 없을까?"+
                            '</span>'+
                          '</div>'+
                          '<div style="width:1px; height:12px"/>'+
                          '<div class="goods-chatRight">'+
                            '<span class="goods-chatRight-text">'+
                            "토버스의"+
                            '</span>'+
                          '</div>'+
                          '<div class="goods-chatRight">'+
                            '<span class="goods-chatRight-text">'+
                            '<span class="goods-chatRight-bold">'+
                              "고보습, 약산성 조약돌 샴푸바"+
                            '</span>'+
                            "는 어때?"+
                            '</span>'+
                          '</div>'+
                          '<div class="goods-chatRight">'+
                            '<span class="goods-chatRight-text">'+
                            "자연성분이라 어쩌고저쩌고 히얄로어쩌고"+
                            '<br/>'+
                            "무슨무슨 성분때문에 두피에 아주좋아"+
                            '</span>'+
                          '</div>'+
                          '<div class="goods-chatRight">'+
                            '<span class="goods-chatRight-text">'+
                            "지금 "+
                            '<span class="goods-chatRight-bold">'+
                            "2025 리뉴얼 프로모션"+
                            '</span>'+
                            "으로"+
                            '<br/>'+
                            "20% 세일도 하더라구~ 한번 둘러봐!"+
                            '</span>'+
                          '</div>'+
                          '</div>';

      // 샴푸바 버튼
      var goToShampooBtn = '<a href="http://towbus.kr/goods/goods_view.php?goodsNo=1000000009&mtn=1%5E%7C%5EBest+Product%5E%7C%5En">'+
                          '<button class="goods-go-btn">'+
                          "샴푸바 보러가기"+
                          '</button>'+
                          '</a>';

      // 메인페이지 샴푸 설명
      var descShampoo = '<div class="goods-desc-wrapper">'+
                      '<div class="goods-desc-header">'+
                        '<img class="goods-desc-logo" src="../img/towbuslogo/towbuslogo.png" alt="logo"/>'+
                        (true&&controlsHtml)+
                      '</div>'+
                      '<h1 class="goods-desc-title">' + shampooTitle + '</h1>' +
                       chatAreaShampoo+
                      '</div>';

      // 전체 래퍼
      return '<div class="goods-product-wrapper">'+
             descShampoo +
             goToShampooBtn +
             '</div>';
  }

  // 예시 비누 콘텐츠 생성 함수 (전역으로 이동)
  function getSoapContent() {
      var soapTitle = "예시 비누";

      // 슬라이더 컨트롤 추가
      var controlsHtml = '<div class="goods-slider-controls">' +
                        '<div class="goods-slider-button-wrapper">'+
                        '<div class="goods-slider-arrow prev">◀</div>' +
                        '<div class="slide-number">' +
                        '<span class="goods-slide-current">'+(window.currentIndex+1)+'</span>'+
                        '<span>'+"/"+'</span>'+
                        '<span>'+window.$items.length+'</span>' +
                        '</div>'+
                        '<div class="goods-slider-arrow next">▶</div>'  +
                        '</div>'+
                        '</div>';

      // 비누 채팅 내용
      var chatAreaSoap = '<div class="goods-desc-chatarea">'+
                      '<div class="goods-chatLeft">'+
                        '<span class="goods-chatLeft-text">'+
                        "우와 토버스다"+
                        '</span>'+
                      '</div>'+
                      '<div class="goods-chatLeft">'+
                        '<span class="goods-chatLeft-text">'+
                        "좀 잘하고 싶은데 방법이 없나??"+
                        '</span>'+
                      '</div>'+
                      '<div style="width:1px; height:12px"/>'+
                      '<div class="goods-chatRight">'+
                        '<span class="goods-chatRight-text">'+
                        "쉽지 않아..."+
                        '</span>'+
                      '</div>'+
                      '<div class="goods-chatRight">'+
                        '<span class="goods-chatRight-text">'+
                        '<span class="goods-chatRight-bold">'+
                          "아무튼 이 비누"+
                        '</span>'+
                        "는 어때?"+
                        '</span>'+
                      '</div>'+
                      '<div class="goods-chatRight">'+
                        '<span class="goods-chatRight-text">'+
                        "진짜 좋은거지롱"+
                        '<br/>'+
                        "아까워서 샴푸바 쓰는 중!"+
                        '</span>'+
                      '</div>'+
                      '</div>';

      // 비누 버튼
      var goToSoapBtn = '<a href="http://towbus.kr/goods/goods_view.php?goodsNo=1000000010">'+
                      '<button class="goods-go-btn">'+
                      "예시 비누 보러가기"+
                      '</button>'+
                      '</a>';

      // 메인페이지 비누 설명
      var descSoap = '<div class="goods-desc-wrapper">'+
                  '<div class="goods-desc-header">'+
                    '<img class="goods-desc-logo" src="../img/towbuslogo/towbuslogo.png" alt="logo"/>'+
                    (true&&controlsHtml)+
                  '</div>'+
                  '<h1 class="goods-desc-title">' + soapTitle + '</h1>' +
                   chatAreaSoap+
                  '</div>';

      // 전체 래퍼
      return '<div class="goods-product-wrapper">'+
             descSoap +
             goToSoapBtn +
             '</div>';
  }

  function gd_get_list_{mainData.sno}{mainData.groupSno}(page) {
      $.get('../goods/goods_main.php', {'mode' : 'get_main', 'more' : page, 'sno' : '{mainData.sno}', 'groupSno' : '{mainData.groupSno}'}, function (data) {
          $(".goods_content_{mainData.sno}{mainData.groupSno}").html(data);
          saveSession(key{mainData.sno}.html, data);
          if (parseInt(page) + 1 > {totalPage}) {
              $('.main_wrap_{mainData.sno}{mainData.groupSno} .btn_goods_view_down_more').hide();
          } else {
              saveSession(key{mainData.sno}.page, parseInt(page)+1);
              $('.main_wrap_{mainData.sno}{mainData.groupSno} .btn_goods_view_down_more').data('page', parseInt(page) + 1);
          }

          // 데이터 로드 후 슬라이더 초기화
          initProductSlider();
      });
  }

  // 상품 슬라이더 초기화 함수
  function initProductSlider() {
      // 약간의 지연 추가 (DOM이 완전히 로드된 후 실행)
      setTimeout(function() {
          // 상품 아이템 선택 (li 태그 선택)
          window.$items = $('.goods_content_{mainData.sno}{mainData.groupSno} ul > li');

          if (window.$items.length <= 1) return; // 상품이 1개 이하면 슬라이더 적용 안함

          // 모든 상품에서 active 클래스 제거
          window.$items.removeClass('active');

          // 첫번째 상품에만 active 클래스 추가
          window.$items.first().addClass('active');

          // 이미 슬라이더 컨트롤이 있으면 제거
          $('.goods-slider-controls, .slide-number, .goods-product-wrapper').remove();

          // 현재 슬라이드 인덱스 초기화
          window.currentIndex = 0;

          // 초기 제품 정보 추가 (첫 번째 슬라이드는 샴푸바)
          var mainPageProductWrapper = getShampooContent();
          $('.goods_content_{mainData.sno}{mainData.groupSno}').append(mainPageProductWrapper);

          // 초기 버튼 상태 설정
          $('.goods-slider-arrow.prev').css('opacity', window.currentIndex === 0 ? 0.5 : 1);
          $('.goods-slider-arrow.next').css('opacity', window.currentIndex === window.$items.length - 1 ? 0.5 : 1);

      }, 500);
  }
  //-->
</script>
<!--{ / }-->
